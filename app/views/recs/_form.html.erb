<%= form_for(@rec, :html => { class: "form"}) do |f| %>
  <% if @rec.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@rec.errors.count, "error") %> prohibited this rec from being saved:</h2>

      <ul>
      <% @rec.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="form-group">
    <%= f.label :attachment %><br>
    <%= f.file_field :attachment, accept: 'image/jpeg,image/gif,image/png' %>
  </div>
  <div class="form-group">
    <%= f.label :company_id %> <%=link_to "new company", new_polymorphic_path(Company), placeholder: "Please select a company.",
        class: "small", :target => "_blank"%><br>
    <%= f.select :company_id, 
      selected_option(@rec.company),
      #options_for_select(Union.all.collect {|u| [u.name, u.id ]}, @rec.union_id) , 
      {
          include_blank: false,
      },
      data: { 
        url: companies_path
      }, 
      class: "ac-select2 form-control", 
      style: "width: 100%;"
    %>
  </div>

  <div class="form-group">
    <% if owner? %>
      <%= f.label :union_id %> <%=link_to "new union", new_polymorphic_path(Union), class: "small", :target => "_blank"%><br>
      <%= f.select :union_id, 
        selected_option(@rec.union),  
        {
            include_blank: false,
        },
        data: { 
          placeholder: "Please select a union.",
          url: unions_path
        }, 
        class: "ac-select2 form-control", 
        style: "width: 100%;"
      %>
    <% else %>
      <%= f.label :union_id %> 
      <br/><%= (@rec.union || current_person.union).name %>
      <br/><small>you can only create and edit agreements belonging to your union</small>
      <%= f.hidden_field :union_id, value: ((@rec.union || current_person.union).id) %>
    <% end %>

  </div>
<!--
  <div class="form-group">
    <%= f.label :taking_action %><br>
    <%= f.check_box :taking_action, class: "switch", :data => { :size => 'small', 'on-text'=>'On', 'off-text'=>'Off', 'on-color'=>'danger'} %>
  </div>
-->
  <div class="form-group">
    <%= f.label :name %><br>
    <%= f.text_field :name, class: "form-control", placeholder: "Please describe the agreement e.g. Nestle Australia (Tongara Plant) And NUW Enterprise Agreement 2014" %>
  </div>
  
  <div class="form-group">
    <%= f.label :person_id %> <%=link_to "invite person", new_person_invitation_path, class: "small", :target => "_blank"%><br>
    <%= f.select :person_id,
      selected_option(@rec.person),
      {
          include_blank: false,
      },
      data: { 
        placeholder: "Please nominate a contact person.",
        url: people_path
      }, 
      class: "ac-select2 form-control", 
      style: "width: 100%;"
    %>
  </div>

  <!--
  <div class="form-group">
    <%= f.label :tags %><br>
    <%= f.text_field :tags %>
  </div>
  -->
  <div class="form-group">
    <%= f.label :start_date %><br>
    <%= f.date_select :start_date %>
  </div>
  <div class="form-group">
    <%= f.label :end_date %><br>
    <%= f.date_select :end_date %>
  </div>
  <div class="form-group">
    <%= f.label :multi_site %><br>
    <%= f.check_box :multi_site, class: "switch", :data => { :size => 'small', 'on-text'=>'Yes', 'off-text'=>'No', 'on-color'=>'success'} %>
  </div>
  <div class="form-group">
    <%= f.label :coverage %><br>
    <%= f.text_area :coverage, class: "form-control", placeholder: "please detail the plant/sites and members being covered" %>
  </div>
  <div class="form-group">
    <%= f.label :nature_of_operation %><br>
    <%= f.select :nature_of_operation,
      nature_of_operation_options, 
      {
          include_blank: true,
      },
      data: { 
        placeholder:  t("helpers.label.rec.nature_of_operation_description"),
      }, 
      multiple: true, 
      class: "ac-select2-tags form-control", 
      style: "width: 100%;"
    %>
  </div>
  <div class="form-group">
    <%= f.label :grievance_handling %><br>
    <%= f.check_box :grievance_handling, :data => { :size => 'small', 'on-text'=>'Yes', 'off-text'=>'No', 'on-color'=>'success'} %>
  </div>
  <div class="form-group">
    <%= f.label :grievance_handling_page %><br>
    <%= f.number_field :grievance_handling_page, class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.label :grievance_handling_clause %><br>
    <%= f.text_area :grievance_handling_clause, class: "form-control", placeholder:  t("helpers.label.rec.grievance_handling_description")%>
  </div>
  <div class="form-group">
    <%= f.label :union_mandate %><br>
    <%= f.check_box :union_mandate, :data => { :size => 'small', 'on-text'=>'Yes', 'off-text'=>'No', 'on-color'=>'success'} %>
  </div>
  <div class="form-group">
    <%= f.label :union_mandate_page %><br>
    <%= f.number_field :union_mandate_page, class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.label :union_mandate_clause %><br>
    <%= f.text_area :union_mandate_clause, class: "form-control", placeholder: t("helpers.label.rec.union_mandate_description") %>
  </div>
  <div class="form-group">
    <%= f.label :anti_precariat %><br>
    <%= f.check_box :anti_precariat, :data => { :size => 'small', 'on-text'=>'Yes', 'off-text'=>'No', 'on-color'=>'success'} %>
  </div>
  <div class="form-group">
    <%= f.label :anti_precariat_page %><br>
    <%= f.number_field :anti_precariat_page, class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.label :anti_precariat_clause %><br>
    <%= f.text_area :anti_precariat_clause, class: "form-control", placeholder: t("helpers.label.rec.anti_precariat_description") %>
  </div>
  <div class="form-group">
    <%= f.label :specific_rights %><br>
    <%= f.check_box :specific_rights, :data => { :size => 'small', 'on-text'=>'Yes', 'off-text'=>'No', 'on-color'=>'success'} %>
  </div>
  <div class="form-group">
    <%= f.label :specific_rights_page %><br>
    <%= f.number_field :specific_rights_page, class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.label :specific_rights_clause %><br>
    <%= f.text_area :specific_rights_clause, class: "form-control", placeholder: t("helpers.label.rec.specific_rights_description") %>
  </div>
  <div class="form-group">
    <%= f.label :other_provisions %><br>
    <%= f.text_area :other_provisions, class: "form-control", placeholder: t("helpers.label.rec.other_provisions_description") %>
  </div>
  <div class="actions">
    <%= f.submit value: "Save Agreement", class: "btn btn-default"%>
  </div>
<% end %>

<script type="text/javascript">
  
  function rec_ready() {

    $('input[type=number]').bind('keypress', function (e) {
      return !(e.which != 8 && e.which != 0 &&
              (e.which < 48 || e.which > 57) && e.which != 46);
    });


    <% %w[grievance_handling anti_precariat union_mandate specific_rights].each do |q| %>
      function toggle_<%= q %>() {
        if ($('#rec_<%= q %>').bootstrapSwitch('state')) {
          $('#rec_<%= q %>_page').parent().slideDown();
          $('#rec_<%= q %>_clause').parent().slideDown();
        } else {
          $('#rec_<%= q %>_page').parent().slideUp();
          $('#rec_<%= q %>_clause').parent().slideUp();
        }
      }  

      $('#rec_<%= q %>').bootstrapSwitch({
        onSwitchChange: toggle_<%= q %>
      });

      toggle_<%= q %>();  
    <% end %>
  }

  $(document).ready(rec_ready);
  $(document).on('page:load', rec_ready);
</script>